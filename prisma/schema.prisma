generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserType {
  CLIENTE
  VENDEDOR
  ADMIN
}

enum LojaStatus {
  PENDENTE @map("pendente")
  APROVADA @map("aprovada")
  INATIVA  @map("inativa")
}

enum StatusPedido {
  PENDENTE
  PREPARO
  A_CAMINHO
  ENTREGUE
  CANCELADO
}

enum FormaPagamento {
  PIX
  CARTAO
  DINHEIRO
}

enum StatusPagamento {
  PENDENTE
  PAGO
  RECUSADO
  ESTORNADO
}

model Usuario {
  id       Int      @id @default(autoincrement())
  nome     String   @db.VarChar(100)
  email    String   @unique @db.VarChar(120)
  senha    String   @db.VarChar(255)
  telefone String?  @db.VarChar(20)
  tipo     UserType @default(CLIENTE)

  status Boolean @default(true)

  dataCriacao DateTime @default(now()) @map("data_criacao")

  loja Loja?

  pedidos Pedido[] @relation("UsuarioPedidos")

  enderecos Endereco[]

  @@map("usuarios")
}

model Endereco {
  id Int @id @default(autoincrement())

  usuarioId Int     @map("id_usuario")
  usuario   Usuario @relation(fields: [usuarioId], references: [id])

  apelido      String  @db.VarChar(60)
  destinatario String  @db.VarChar(120)
  telefone     String? @db.VarChar(20)

  cep         String? @db.VarChar(10)
  logradouro  String  @db.VarChar(160)
  numero      String? @db.VarChar(20)
  bairro      String? @db.VarChar(80)
  cidade      String? @db.VarChar(80)
  uf          String? @db.VarChar(2)
  complemento String? @db.VarChar(160)

  principal Boolean @default(false)

  dataCriacao  DateTime @default(now()) @map("data_criacao")
  dataAtualiza DateTime @updatedAt @map("data_atualiza")

  @@index([usuarioId])
  @@map("enderecos")
}

model Loja {
  id        Int     @id @default(autoincrement())
  nome      String  @db.VarChar(120)
  descricao String?

  usuarioId Int @unique @map("id_vendedor")

  endereco String? @db.VarChar(255)
  telefone String? @db.VarChar(20)

  imagemLogo String? @map("imagem_logo") @db.VarChar(255)

  status LojaStatus @default(PENDENTE)

  horarioAbertura   DateTime? @map("horario_abertura") @db.Time
  horarioFechamento DateTime? @map("horario_fechamento") @db.Time

  dataCriacao DateTime @default(now()) @map("data_criacao")

  dono Usuario @relation(fields: [usuarioId], references: [id])

  produtos Produto[]

  pedidos Pedido[]

  @@map("lojas")
}

model Categoria {
  id   Int    @id @default(autoincrement())
  nome String @db.VarChar(120)

  produtos Produto[]

  @@map("categorias")
}

model Produto {
  id        Int     @id @default(autoincrement())
  nome      String  @db.VarChar(100)
  descricao String?
  preco     Decimal @db.Decimal(10, 2)

  imagemUrl String? @map("imagem_principal") @db.VarChar(255)

  estoque Int @default(0)

  ativo Boolean @default(true)

  dataCriacao DateTime @default(now()) @map("data_cadastro")

  idCategoria Int?       @map("id_categoria")
  categoria   Categoria? @relation(fields: [idCategoria], references: [id])

  lojaId Int
  loja   Loja @relation(fields: [lojaId], references: [id])

  itensPedido ItemPedido[]

  @@index([lojaId])
  @@map("produtos")
}

model Pedido {
  id Int @id @default(autoincrement())

  dataCriacao DateTime @default(now()) @map("data_criacao")

  status         StatusPedido   @default(PENDENTE)
  formaPagamento FormaPagamento

  enderecoEntrega String @map("endereco_entrega")

  valorTotal Decimal @db.Decimal(10, 2)

  lojaId Int @map("id_loja")
  loja   Loja @relation(fields: [lojaId], references: [id])

  clienteId Int
  cliente   Usuario @relation("UsuarioPedidos", fields: [clienteId], references: [id])

  itens     ItemPedido[]
  pagamento Pagamento?

  @@index([clienteId])
  @@index([lojaId])
  @@map("pedidos")
}

model ItemPedido {
  id            Int     @id @default(autoincrement())
  quantidade    Int
  precoUnitario Decimal @db.Decimal(10, 2)
  subtotal      Decimal @db.Decimal(10, 2)

  pedidoId Int
  pedido   Pedido @relation(fields: [pedidoId], references: [id])

  produtoId Int
  produto   Produto @relation(fields: [produtoId], references: [id])

  @@index([pedidoId])
  @@index([produtoId])
  @@map("itens_pedido")
}

model Pagamento {
  id Int @id @default(autoincrement())

  pedidoId Int @unique @map("id_pedido")
  pedido   Pedido @relation(fields: [pedidoId], references: [id])

  metodo FormaPagamento
  status StatusPagamento @default(PENDENTE)

  valor Decimal @db.Decimal(10, 2)

  dataCriacao DateTime @default(now()) @map("data_criacao")
  dataPago    DateTime? @map("data_pago")

  @@map("pagamentos")
}
