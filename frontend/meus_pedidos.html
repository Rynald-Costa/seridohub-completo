<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pedidos recebidos - SeridóHub</title>

  <!-- Bootstrap 5 -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
  />

  <!-- CSS da aplicação -->
  <link rel="stylesheet" href="css/global.css" />
  <link rel="stylesheet" href="css/pedidos_vendedor.css" />

  <!-- Layout para manter o footer no fim da página -->
  <style>
    html,
    body {
      height: 100%;
    }

    body {
      display: flex;
      flex-direction: column;
    }

    main {
      flex: 1 0 auto;
    }
  </style>
</head>
<body>

  <!-- header_app.html será carregado automaticamente -->
  <div id="site-header"></div>

  <main>
    <div class="container-fluid py-3 pedidos-page">
      <div class="pedidos-wrapper mx-auto">

        <!-- Título e contexto -->
        <div class="d-flex flex-wrap align-items-center justify-content-between gap-2 mb-3">
          <div>
            <h1 class="h4 mb-1">Pedidos recebidos</h1>
            <p class="text-muted small mb-0">
              Veja os pedidos feitos na sua loja e atualize o status em tempo real.
            </p>
          </div>
          <span class="badge rounded-pill bg-light text-muted border small">
            Painel do vendedor
          </span>
        </div>

        <!-- Filtros rápidos -->
        <div class="card mb-3 pedidos-filtro-card">
          <div class="card-body">
            <div class="row g-2 align-items-end">
              <div class="col-12 col-md-4">
                <label for="filtro-busca" class="form-label form-label-sm">
                  Buscar por código ou cliente
                </label>
                <div class="input-group input-group-sm">
                  <span class="input-group-text bg-light border-end-0">
                    <i class="bi bi-search"></i>
                  </span>
                  <input
                    type="search"
                    id="filtro-busca"
                    class="form-control border-start-0"
                    placeholder="Ex.: #1024, Maria Silva..."
                  />
                </div>
              </div>

              <div class="col-6 col-md-3">
                <label for="filtro-status" class="form-label form-label-sm">
                  Status do pedido
                </label>
                <select id="filtro-status" class="form-select form-select-sm">
                  <option value="">Todos</option>
                  <option value="PENDENTE">Pendente</option>
                  <option value="EM_PREPARO">Em preparo</option>
                  <option value="SAIU_PARA_ENTREGA">Saiu para entrega</option>
                  <option value="ENTREGUE">Entregue</option>
                  <option value="CANCELADO">Cancelado</option>
                </select>
              </div>

              <div class="col-6 col-md-3">
                <label for="filtro-ordenacao" class="form-label form-label-sm">
                  Ordenar por
                </label>
                <select id="filtro-ordenacao" class="form-select form-select-sm">
                  <option value="mais-recentes">Mais recentes</option>
                  <option value="mais-antigos">Mais antigos</option>
                  <option value="maior-valor">Maior valor</option>
                  <option value="menor-valor">Menor valor</option>
                </select>
              </div>

              <div class="col-12 col-md-2 text-md-end">
                <button id="btn-limpar-filtros" class="btn btn-outline-secondary btn-sm w-100 mt-2 mt-md-0">
                  Limpar filtros
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Lista de pedidos -->
        <div class="card pedidos-lista-card">
          <div class="card-body p-0">
            <!-- Estados de carregamento -->
            <div id="pedidos-loading" class="p-3 text-muted small">
              Carregando pedidos...
            </div>

            <div id="pedidos-empty" class="p-3 text-muted small d-none">
              Nenhum pedido encontrado ainda. Assim que os clientes fizerem pedidos na sua loja,
              eles aparecerão aqui.
            </div>

            <div id="pedidos-error" class="alert alert-danger m-3 d-none">
              Não foi possível carregar os pedidos. Tente novamente mais tarde.
            </div>

            <!-- Tabela -->
            <div class="table-responsive d-none" id="pedidos-tabela-wrapper">
              <table class="table table-hover align-middle mb-0 pedidos-tabela">
                <thead class="table-light">
                  <tr>
                    <th scope="col">Pedido</th>
                    <th scope="col">Cliente</th>
                    <th scope="col" class="text-center">Itens</th>
                    <th scope="col" class="text-end">Total</th>
                    <th scope="col">Pagamento</th>
                    <th scope="col">Status</th>
                    <th scope="col" class="text-end">Ações</th>
                  </tr>
                </thead>
                <tbody id="pedidos-tbody">
                  <!-- Linhas inseridas via JS -->
                </tbody>
              </table>
            </div>
          </div>
        </div>

      </div>
    </div>
  </main>

  <!-- MODAL: Detalhes do pedido + atualização de status -->
  <div
    class="modal fade modal-pedido"
    id="modal-detalhe-pedido"
    tabindex="-1"
    aria-hidden="true"
  >
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <div>
            <h5 class="modal-title mb-0">
              Pedido <span id="modal-pedido-codigo">#</span>
            </h5>
            <small class="text-muted" id="modal-pedido-data"></small>
          </div>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Fechar"
          ></button>
        </div>

        <div class="modal-body">
          <div class="row g-3">
            <!-- Coluna esquerda: infos do cliente e entrega -->
            <div class="col-12 col-lg-5">
              <h6 class="fw-semibold mb-2">Dados do cliente</h6>
              <p class="mb-1 small">
                <span class="text-muted d-block">Nome</span>
                <span id="modal-cliente-nome">—</span>
              </p>
              <p class="mb-1 small">
                <span class="text-muted d-block">Contato</span>
                <span id="modal-cliente-contato">—</span>
              </p>
              <p class="mb-3 small">
                <span class="text-muted d-block">Endereço de entrega</span>
                <span id="modal-endereco-entrega">—</span>
              </p>

              <h6 class="fw-semibold mb-2">Pagamento</h6>
              <p class="mb-1 small">
                <span class="text-muted d-block">Forma de pagamento</span>
                <span id="modal-pagamento-forma">—</span>
              </p>
              <p class="mb-0 small">
                <span class="text-muted d-block">Total</span>
                <span id="modal-pagamento-total" class="fw-semibold">—</span>
              </p>
            </div>

            <!-- Coluna direita: itens + status -->
            <div class="col-12 col-lg-7">
              <h6 class="fw-semibold mb-2">Itens do pedido</h6>
              <div class="border rounded-3 p-2 mb-3 bg-light-subtle modal-itens-wrapper">
                <ul class="list-unstyled mb-0 small" id="modal-itens-lista">
                  <!-- Itens via JS -->
                </ul>
              </div>

              <h6 class="fw-semibold mb-2">Status do pedido</h6>
              <div class="row g-2 align-items-center">
                <div class="col-12 col-md-7">
                  <label for="modal-status-select" class="form-label form-label-sm">
                    Atualizar status
                  </label>
                  <select id="modal-status-select" class="form-select form-select-sm">
                    <option value="PENDENTE">Pendente</option>
                    <option value="EM_PREPARO">Em preparo</option>
                    <option value="SAIU_PARA_ENTREGA">Saiu para entrega</option>
                    <option value="ENTREGUE">Entregue</option>
                    <option value="CANCELADO">Cancelado</option>
                  </select>
                </div>
                <div class="col-12 col-md-5 text-md-end">
                  <button
                    id="btn-salvar-status"
                    class="btn btn-primary btn-sm mt-2 mt-md-4"
                    type="button"
                  >
                    <i class="bi bi-check2-circle me-1"></i>
                    Salvar status
                  </button>
                </div>
              </div>

              <p class="small text-muted mt-2 mb-0" id="modal-status-atual-texto">
                Status atual: —
              </p>
            </div>
          </div>
        </div>

        <div class="modal-footer justify-content-between">
          <span class="small text-muted" id="modal-pedido-observacao">
            Observações do cliente: —
          </span>
          <button
            type="button"
            class="btn btn-outline-secondary btn-sm"
            data-bs-dismiss="modal"
          >
            Fechar
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- FOOTER (carregado via partial) -->
  <div id="site-footer"></div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- carrega header e footer -->
  <script src="js/layout.js"></script>

  <!-- helpers de autenticação -->
  <script src="js/auth.js"></script>

  <!-- lógica da página de pedidos do vendedor -->
  <script src="js/pedidos_vendedor.js"></script>

</body>
</html>
